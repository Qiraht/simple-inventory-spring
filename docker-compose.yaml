services:
  simple-inventory-spring:
    build:
      context: .
      dockerfile: Dockerfile
    image: qiraht/simple-inventory-spring:latest
    container_name: simple-inventory-spring
    ports:
      - "${APP_PORT:-8080}:${APP_PORT:-8080}"
    env_file:
      - .env
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      - APP_PORT=${APP_PORT:-8080}
      ## Mysql
      - DB_HOST=${DB_HOST}
      - DB_PORT=${DB_PORT}
      - DB_NAME=${DB_NAME}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      ## Redis
      - REDIS_HOST=${REDIS_HOST}
      - REDIS_PORT=${REDIS_PORT}
      - REDIS_USERNAME=${REDIS_USERNAME}
      - REDIS_PASSWORD=${REDIS_PASSWORD}
      ## Spring Security
      - SPRING_USER=${SPRING_USER}
      - SPRING_PASSWORD=${SPRING_PASSWORD}
    restart: always
      #    depends_on:
      #      grafana:
      #        condition: service_started
      #      redis:
      #        condition: service_healthy
      #      mysql:
      #        condition: service_healthy

  ## MySQL
#  mysql:
#    image: mysql:8.0-bookworm
#    container_name: mysql-inventory
#    environment:
#        - MYSQL_ROOT_PASSWORD=${DB_PASSWORD}
#        - MYSQL_DATABASE=%{DB_NAME}
#    ports:
#      - "3306:3306"
#    extra_hosts:
      ##    - "host.docker.internal:host-gateway" ## Docker
#      - "host.containers.internal:host-gateway" ## Podman
#    healthcheck:
#      test: [ "CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "root", "-p$$MYSQL_ROOT_PASSWORD" ]
#      timeout: 20s
#      retries: 10
#      interval: 10s
#      start_period: 40s

  ## Redis
#  redis:
#    image: redis:7.4.7-alpine
#    container_name: redis-inventory
#    ports:
#      - "6379:6379"
#    extra_hosts:
      ##    - "host.docker.internal:host-gateway" ## Docker
#      - "host.containers.internal:host-gateway" ## Podman
#    healthcheck:
#      test: [ "CMD", "redis-cli", "--raw", "incr", "ping" ]
#      timeout: 10s
#      retries: 5
#      interval: 5s
#      start_period: 10s

  ## Prometheus
#  prometheus:
#    image: prom/prometheus:main
#    container_name: prometheus-invetory
#    volumes:
#      - ./prometheus.yml:/etc/prometheus/prometheus.yml
#    ports:
#      - "9090:9090"
#    extra_hosts:
  ##    - "host.docker.internal:host-gateway" ## Docker
#      - "host.containers.internal:host-gateway" ## Podman
#    restart: unless-stopped

  ## Grafana
#  grafana:
#    image: grafana/grafana:main
#    container_name: grafana-inventory
#    ports:
#      - "3000:3000"
#    environment:
#      - GF_SECURITY_ADMIN_USER=admin
#      - GF_SECURITY_ADMIN_PASSWORD=admin
#    extra_hosts:
      ##    - "host.docker.internal:host-gateway" ## Docker
#      - "host.containers.internal:host-gateway" ## Podman
#    depends_on:
#      - prometheus
